{% extends "base.html" %}
{% block title %}Financial Health Dashboard - {{ app_name }}{% endblock %}
{% block content %}
<div class="container">
    <h1 style="text-align: center; margin: 30px 0;">📊 Financial Health Dashboard</h1>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
        <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 12px; text-align: center;">
            <div style="font-size: 1rem; margin-bottom: 10px; opacity: 0.9;">Financial Health Score</div>
            <div id="health-score" style="font-size: 3rem; font-weight: 700;">--</div>
            <div style="font-size: 0.9rem; opacity: 0.8;">out of 100</div>
        </div>
        
        <div class="stat-card" style="background: white; border: 2px solid #28a745; padding: 20px; border-radius: 8px;">
            <div style="font-size: 0.9rem; color: #666; margin-bottom: 8px;">💰 Income (30d)</div>
            <div id="income-30d" style="font-size: 1.8rem; font-weight: 700; color: #28a745;">$0.00</div>
        </div>
        
        <div class="stat-card" style="background: white; border: 2px solid #dc3545; padding: 20px; border-radius: 8px;">
            <div style="font-size: 0.9rem; color: #666; margin-bottom: 8px;">💸 Expenses (30d)</div>
            <div id="expenses-30d" style="font-size: 1.8rem; font-weight: 700; color: #dc3545;">$0.00</div>
        </div>
        
        <div class="stat-card" style="background: white; border: 2px solid #667eea; padding: 20px; border-radius: 8px;">
            <div style="font-size: 0.9rem; color: #666; margin-bottom: 8px;">📈 Savings Rate</div>
            <div id="savings-rate" style="font-size: 1.8rem; font-weight: 700; color: #667eea;">0%</div>
        </div>
        
        <div class="stat-card" style="background: white; border: 2px solid #ffc107; padding: 20px; border-radius: 8px;">
            <div style="font-size: 0.9rem; color: #666; margin-bottom: 8px;">💰 Total Balance</div>
            <div id="total-balance" style="font-size: 1.8rem; font-weight: 700; color: #333;">$0.00</div>
        </div>
        
        <div class="stat-card" style="background: white; border: 2px solid #6c757d; padding: 20px; border-radius: 8px;">
            <div style="font-size: 0.9rem; color: #666; margin-bottom: 8px;">📋 Active Budgets</div>
            <div id="budget-count" style="font-size: 1.8rem; font-weight: 700; color: #333;">0</div>
        </div>
    </div>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px;">
        <div class="card">
            <div class="card-header"><h2>🏆 Top Spending Categories (30d)</h2></div>
            <div class="card-body">
                <div id="top-categories-list"></div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header"><h2>📊 Quick Links</h2></div>
            <div class="card-body">
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <a href="/accounts" class="btn btn-primary" style="text-decoration: none;">💳 Manage Accounts</a>
                    <a href="/transactions" class="btn btn-primary" style="text-decoration: none;">🔍 View Transactions</a>
                    <a href="/budgets" class="btn btn-primary" style="text-decoration: none;">💰 Manage Budgets</a>
                    <a href="/recurring" class="btn btn-primary" style="text-decoration: none;">🔄 Recurring Payments</a>
                    <a href="/reports" class="btn btn-primary" style="text-decoration: none;">📈 View Reports</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
async function loadDashboard() {
    try {
        const response = await fetch('/dashboard/api/health');
        const data = await response.json();
        
        if (data.success) {
            const h = data.health;
            
            document.getElementById('health-score').textContent = h.health_score;
            document.getElementById('income-30d').textContent = formatCurrency(h.income_30d);
            document.getElementById('expenses-30d').textContent = formatCurrency(h.expenses_30d);
            document.getElementById('savings-rate').textContent = h.savings_rate.toFixed(1) + '%';
            document.getElementById('total-balance').textContent = formatCurrency(h.total_balance);
            document.getElementById('budget-count').textContent = h.budget_count;
            
            // Top categories
            const topCatList = document.getElementById('top-categories-list');
            if (h.top_categories && h.top_categories.length > 0) {
                topCatList.innerHTML = h.top_categories.map((cat, idx) => `
                    <div style="display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid #eee;">
                        <span><strong>${idx+1}.</strong> ${cat.name}</span>
                        <span style="font-weight: 700; color: #dc3545;">${formatCurrency(cat.total)}</span>
                    </div>
                `).join('');
            } else {
                topCatList.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">No spending data yet</p>';
            }
        }
    } catch (error) {
        console.error('Error loading dashboard:', error);
    }
}

function formatCurrency(amount) {
    if (amount === null || amount === undefined) return '$0.00';
    return '$' + Math.abs(amount).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
}

document.addEventListener('DOMContentLoaded', loadDashboard);
</script>
{% endblock %}
