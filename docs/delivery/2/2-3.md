# Task 2-3: Implement Transaction Validation Logic

[Back to task list](./tasks.md)

## Description

Create a validation service to ensure transaction data integrity before storing in the database. This service validates dates, amounts, descriptions, and ensures all required fields are present and correctly formatted.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-19 19:35:00 | Created | N/A | Proposed | Task created | Saeed |
| 2025-10-19 19:35:00 | Approved | Proposed | Agreed | Task approved for implementation | Saeed |
| 2025-10-19 19:35:00 | Started | Agreed | InProgress | Beginning implementation | Saeed |
| 2025-10-19 19:50:00 | Completed | InProgress | Review | Implementation and tests complete, all 25 tests passing | Saeed |
| 2025-10-19 20:16:00 | Approved | Review | Done | Validation service tested and working correctly | Saeed |

## Requirements

1. Validate transaction dates (not in future, reasonable past range)
2. Validate amounts (non-zero, reasonable range)
3. Validate descriptions (not empty after trimming)
4. Validate account_id exists
5. Return validation results with clear error messages
6. Support bulk validation (list of transactions)
7. Collect all validation errors, not just first one

## Implementation Plan

### 1. Create Validation Service (`src/services/transaction_validator.py`)

**Validation Rules:**

**Date Validation:**
- Must be a valid date object
- Cannot be in the future
- Should be within reasonable range (e.g., not more than 10 years in past)
- Configurable date range limits

**Amount Validation:**
- Must be a non-zero number
- Should be within reasonable range (-$1M to +$1M configurable)
- Must be valid float

**Description Validation:**
- Not empty after stripping whitespace
- Minimum length (e.g., 1 character)
- Maximum length (e.g., 500 characters)

**Account ID Validation:**
- Account ID must exist in database (if provided)

### 2. Validation Result Structure

```python
{
    'valid': True/False,
    'errors': [
        {
            'field': 'date',
            'message': 'Date cannot be in the future'
        },
        ...
    ]
}
```

### 3. Bulk Validation Support

```python
validate_transactions([transaction1, transaction2, ...])
# Returns: [(transaction, validation_result), ...]
```

## Test Plan

**Success Criteria:**
- Valid transactions pass validation
- Invalid dates are rejected with clear messages
- Invalid amounts are rejected
- Empty descriptions are rejected  
- Future dates are rejected
- All validation errors are collected
- Bulk validation works correctly

**Unit Tests:**
- test_valid_transaction()
- test_invalid_date_future()
- test_invalid_date_too_old()
- test_invalid_date_not_date_object()
- test_invalid_amount_zero()
- test_invalid_amount_too_large()
- test_invalid_amount_too_negative()
- test_invalid_amount_not_number()
- test_invalid_description_empty()
- test_invalid_description_whitespace_only()
- test_invalid_description_too_long()
- test_multiple_errors_collected()
- test_bulk_validation()
- test_validation_with_account_id()

## Verification

- [x] Validation service created
- [x] Date validation implemented (future dates, past limit, type check)
- [x] Amount validation implemented (zero, range, type check)
- [x] Description validation implemented (empty, length limits)
- [x] Account ID validation implemented (exists in database)
- [x] Multiple errors collected
- [x] Bulk validation supported
- [x] Clear error messages
- [x] Tests passing (25/25 tests)

## Files Modified

**Created:**
- `src/services/transaction_validator.py`
- `tests/unit/test_transaction_validator.py`

## Notes

- Keep validation rules configurable for flexibility
- Don't validate categorization here (that's separate)
- Focus on data integrity only
- Account existence validation will require database access

