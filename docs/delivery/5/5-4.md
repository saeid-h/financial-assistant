# [5-4] Implement Spending by Category pie chart

[Back to task list](./tasks.md)

## Description

Create API endpoint and frontend code to display a pie chart showing the breakdown of spending by category for the current period. This helps users quickly see where their money is going.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-19 23:25:00 | Created | N/A | Proposed | Task file created | Saeed |

## Requirements

### Functional Requirements
1. Create API endpoint `/reports/api/category-breakdown`
2. Return JSON with category names and amounts
3. Implement Chart.js pie chart showing category distribution
4. Use consistent colors for each category across all charts
5. Show percentage in tooltips
6. Chart updates when filters change

### Implementation Plan

1. **API Endpoint**: Add route to `src/routes/reports.py`:
   - Call `report_service.get_category_breakdown()`
   - Format as Chart.js pie chart data
   - Return labels (category names) and data (amounts)
   - Include backgroundColor array with distinct colors

2. **JavaScript Chart**: In `src/templates/reports.html`:
   - Function `loadCategoryPieChart()`
   - Create Chart.js pie chart with type: 'pie'
   - Configure tooltips to show amount and percentage
   - Use color palette from app theme

3. **Color Management**:
   - Define consistent color palette for categories
   - Store in JavaScript object/map
   - Reuse colors across all charts

## Test Plan

- API endpoint returns correct category totals
- Pie chart displays with correct segments
- Tooltips show category name, amount, and percentage
- Chart updates when filters change
- Empty data shows "No data" message
- Colors are visually distinct

## Files Modified

- `src/routes/reports.py` - Add `/api/category-breakdown` endpoint
- `src/templates/reports.html` - Add pie chart JavaScript
- `tests/integration/test_reports.py` - Add test for API

## Notes

- Consider grouping small categories into "Other" if > 10 categories
- Show "Uncategorized" as a separate slice if transactions exist
- Pie chart should have legend showing category names and amounts

