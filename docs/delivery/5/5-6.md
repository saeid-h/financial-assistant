# [5-6] Implement Top Categories horizontal bar chart

[Back to task list](./tasks.md)

## Description

Create API endpoint and frontend code to display a horizontal bar chart showing the top spending categories. This provides a quick view of where the most money is being spent.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-19 23:25:00 | Created | N/A | Proposed | Task file created | Saeed |
| 2025-10-19 23:55:00 | Status Change | Proposed | Agreed | Task approved | Saeed |
| 2025-10-19 23:55:00 | Status Change | Agreed | InProgress | Started implementation | Saeed |
| 2025-10-20 00:00:00 | Status Change | InProgress | Done | Top categories horizontal bar chart complete with transaction counts and averages in tooltips | Saeed |

## Requirements

### Functional Requirements
1. Create API endpoint `/reports/api/top-categories`
2. Return JSON with top 10 categories by spending
3. Implement Chart.js horizontal bar chart
4. Bars ordered from highest to lowest spend
5. Show transaction count in tooltips
6. Chart updates when filters change

### Implementation Plan

1. **API Endpoint**: Add route to `src/routes/reports.py`:
   - Call `report_service.get_top_categories(limit=10)`
   - Format for Chart.js horizontal bar
   - Return category names as labels (Y-axis)
   - Return amounts as data (X-axis)

2. **JavaScript Chart**: In `src/templates/reports.html`:
   - Function `loadTopCategoriesChart()`
   - Create Chart.js bar chart with `indexAxis: 'y'` for horizontal bars
   - Sort data by amount descending
   - Color bars using category color palette

3. **Tooltip Enhancement**:
   - Show category name
   - Show total amount
   - Show transaction count
   - Show average per transaction

## Test Plan

- API returns top 10 categories correctly ordered
- Horizontal bars display properly
- Chart is sorted highest to lowest
- Tooltips show detailed information
- Chart updates with filters

## Files Modified

- `src/routes/reports.py` - Add `/api/top-categories` endpoint
- `src/templates/reports.html` - Add horizontal bar chart JavaScript
- `tests/integration/test_reports.py` - Add test for API

## Notes

- Horizontal bars are easier to read with long category names
- Consider adding sparklines showing trend (future enhancement)
- Empty state should show "No spending data available"

