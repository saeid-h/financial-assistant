# [5-5] Implement Monthly Expenses stacked bar chart

[Back to task list](./tasks.md)

## Description

Create API endpoint and frontend code to display a stacked bar chart showing monthly expenses broken down by category. This helps users see spending trends over time and identify which categories are increasing or decreasing.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-19 23:25:00 | Created | N/A | Proposed | Task file created | Saeed |
| 2025-10-19 23:55:00 | Status Change | Proposed | Agreed | Task approved | Saeed |
| 2025-10-19 23:55:00 | Status Change | Agreed | InProgress | Started implementation | Saeed |
| 2025-10-20 00:00:00 | Status Change | InProgress | Done | Monthly expenses stacked bar chart complete showing top 10 categories over time | Saeed |

## Requirements

### Functional Requirements
1. Create API endpoint `/reports/api/monthly-category-trends`
2. Return JSON with months and category data suitable for stacked bar chart
3. Implement Chart.js stacked bar chart
4. Each bar represents a month, stacked by category
5. Use same colors as pie chart for consistency
6. Show category totals in tooltips
7. Chart updates when filters change

### Implementation Plan

1. **API Endpoint**: Add route to `src/routes/reports.py`:
   - Call `report_service.get_monthly_category_trends()`
   - Format as Chart.js stacked bar data structure
   - Return months as labels
   - Return datasets array (one per category)
   - Each dataset: {label: 'CategoryName', data: [amounts per month], backgroundColor: color}

2. **JavaScript Chart**: In `src/templates/reports.html`:
   - Function `loadMonthlyCategoryChart()`
   - Create Chart.js bar chart with type: 'bar'
   - Configure options: `stacked: true` for both x and y axes
   - Tooltips show category and amount

3. **Data Structure**:
   ```javascript
   {
     labels: ['2024-01', '2024-02', ...],
     datasets: [
       {label: 'Groceries', data: [500, 520, 480, ...], ...},
       {label: 'Rent', data: [2000, 2000, 2000, ...], ...},
       ...
     ]
   }
   ```

## Test Plan

- API returns correct monthly category data
- Stacked bar chart displays correctly
- Each bar shows all categories stacked
- Tooltips work on hover
- Legend shows all categories
- Chart updates with filters

## Files Modified

- `src/routes/reports.py` - Add `/api/monthly-category-trends` endpoint
- `src/templates/reports.html` - Add stacked bar chart JavaScript
- `tests/integration/test_reports.py` - Add test for API

## Notes

- Limit to top 10 categories to avoid cluttered chart
- Group remaining categories as "Other"
- X-axis should show month labels clearly
- Consider horizontal scrolling if > 24 months

